# 🚨 Grandma Alert プロジェクト概要・進捗説明資料

**最終更新:** 2026年1月23日  
**対象者:** ステークホルダー、新規参画メンバー、プロジェクトレビュアー

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [システムアーキテクチャ](#システムアーキテクチャ)
3. [現在の実装状況](#現在の実装状況)
4. [主要機能の進捗](#主要機能の進捗)
5. [セキュリティ対応状況](#セキュリティ対応状況)
6. [今後の実装予定](#今後の実装予定)
7. [既知の問題と課題](#既知の問題と課題)
8. [コスト見積もり](#コスト見積もり)

---

## 1. プロジェクト概要

### 🎯 目的

高齢者の緊急時に、家族グループLINEへ**「気づくまで画像を送り続ける（通知の嵐）」**ことで、確実な認知と初動対応を実現する緊急通報システムです。

### 🔑 キーコンセプト

- **Continuous Alert（継続的警告）:** 5秒に1回、現場の写真をLINEグループに自動送信
- **Rich Menu Control（リッチメニュー制御）:** タイムラインに依存せず、「通報」「誤報解除」を即座に操作できる固定メニュー
- **Multi-View（マルチビュー）:** 複数台のカメラ映像をWebダッシュボードで一覧監視

### 💡 特徴

- **人命優先設計:** コストやAPI制限よりも、人命と対応スピードを最優先
- **エッジデバイス:** Raspberry Pi + カメラモジュール + 物理ボタン
- **クラウド基盤:** AWS（IoT Core、S3、Lambda、DynamoDB）
- **通知手段:** LINE Messaging API

---

## 2. システムアーキテクチャ

### 🏗 システム構成図

```
┌─────────────────────────────────────────────────────────────────┐
│                        Hardware Layer                            │
│  ┌────────────┐        ┌──────────────────────────────────┐    │
│  │  高齢者    │ ────→  │  Raspberry Pi + Camera Module    │    │
│  │(物理ボタン)│        │  + 物理ボタン (GPIO接続)         │    │
│  └────────────┘        └──────────────────────────────────┘    │
└───────────────────────────────────┬─────────────────────────────┘
                                    │
                    ┌───────────────┼───────────────┐
                    ↓               ↓               ↓
┌───────────────────────────────────────────────────────────────────┐
│                          AWS Cloud                                 │
│                                                                    │
│  ┌──────────────┐     ┌────────────────┐     ┌──────────────┐   │
│  │  AWS IoT     │ ←→  │ Device Shadow  │     │  Amazon S3   │   │
│  │  Core (MQTT) │     │ (ステータス管理)│     │  (画像保存)  │   │
│  └──────────────┘     └────────────────┘     └──────┬───────┘   │
│                                                      │           │
│                                              ┌───────┴───────┐   │
│  ┌──────────────┐     ┌────────────────┐   │  CloudFront   │   │
│  │  DynamoDB    │ ←── │  Lambda関数    │   │ (CDN + 署名   │   │
│  │ (通報情報)   │     │  - 通知処理    │   │   付きURL)    │   │
│  └──────────────┘     │  - コマンド処理│   └───────────────┘   │
│                       └────────┬───────┘                        │
└────────────────────────────────┼───────────────────────────────┘
                                 │
                    ┌────────────┼────────────┐
                    ↓            ↓            ↓
┌───────────────────────────────────────────────────────────────────┐
│                      User Interface                                │
│                                                                    │
│  ┌──────────────────┐         ┌─────────────────────────────┐   │
│  │  LINE Messaging  │ ────→   │  👨‍👩‍👧‍👦 家族グループLINE     │   │
│  │  API             │         │  (通知の嵐 + リッチメニュー) │   │
│  └──────────────────┘         └─────────────────────────────┘   │
│                                                                    │
│  ┌──────────────────┐         ┌─────────────────────────────┐   │
│  │  Web Dashboard   │ ────→   │  🖥 家族（ブラウザ表示）    │   │
│  │  (S3 Hosting)    │         │  複数カメラの一覧監視       │   │
│  └──────────────────┘         └─────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────┘
```

### 📦 主要コンポーネント

#### A. エッジデバイス (Raspberry Pi)

- **ハードウェア:** Raspberry Pi + Camera Module + 物理ボタン
- **ソフトウェア:** Python 3.x + AWS IoT SDK + boto3 + OpenCV
- **機能:**
  - 物理ボタン監視 (GPIO)
  - AWS IoT Device Shadow との同期
  - 5秒間隔での撮影とS3アップロード
  - 緊急モード/待機モードの切り替え

#### B. AWS IoT Core & Device Shadow

- ステータス管理の中心
- 状態: `monitoring` (通常) / `alert` (緊急)
- ラズパイとクラウド間のリアルタイム同期

#### C. Amazon S3

- **Images Bucket:** 撮影画像の保存（プライベート）
- **Dashboard Bucket:** 静的Webサイトホスティング（CloudFront経由）
- ライフサイクル設定で古い画像を自動削除（1日後）

#### D. CloudFront

- S3へのアクセスをCDN経由で高速化
- 署名付きURL機能でセキュアなアクセス制御
- 画像配信の負荷分散

#### E. AWS Lambda

- **通知処理:** S3へのアップロードをトリガーにLINEへ画像送信
- **コマンド処理:** LINEリッチメニューからのアクションを処理
  - 「通報する」→ DynamoDBから通報情報を取得してLINE送信
  - 「大丈夫（解除）」→ Device Shadowを更新して撮影停止

#### F. DynamoDB

- 通報用テンプレート情報を格納
  - 住所、電話番号、既往歴、緊急連絡先など

#### G. LINE Messaging API

- 家族グループへの通知配信
- リッチメニューでの操作インターフェース
- Webhook経由でのコマンド受信

---

## 3. 現在の実装状況

### ✅ 実装完了項目

#### LINE Messaging API 設定 ✅

- [x] プロバイダー・チャネル作成
- [x] Channel Access Token 発行
- [x] 家族グループLINE作成 & Bot招待
- [x] Group ID 取得: `Cd0d26de7f9ed6ba055297c0d0253efad`

#### AWS IoT Core ✅

- [x] Thing 作成: `ElderlyCam_01`
- [x] 証明書発行（Cert、Private Key、Root CA）
- [x] IoT Endpoint: `a2kvsxl8s30u6t-ats.iot.ap-northeast-1.amazonaws.com`
- [x] ポリシー作成 & アタッチ（Connect, Publish, Subscribe, Receive）

#### S3 Images Bucket ✅

- [x] プライベートバケット作成
- [x] バージョニング有効化
- [x] サーバーサイド暗号化（AES256）
- [x] ライフサイクルルール設定（1日後自動削除）

#### S3 Dashboard Bucket ✅

- [x] 静的Webサイトホスティング設定
- [x] CloudFront ディストリビューション作成
- [x] Origin Access Control (OAC) 設定
- [x] CORS設定
- [x] HTML/CSSファイル実装とデプロイ

#### Lambda - GenerateSignedURL ✅

- [x] CloudFront署名付きURL生成機能
- [x] API Gateway統合
- [x] 有効期限設定（1時間）
- [x] エラーハンドリング実装

#### Lambda - FetchGroupID ✅

- [x] LINE Group ID取得用API基盤
- [x] API Gateway設定
- [x] ダミーレスポンス実装

#### Terraform管理 ✅

- [x] すべてのリソースをTerraformで管理
- [x] モジュール化された構成
- [x] 変数とタグの統一管理

---

### ⏳ 部分実装・調整中

#### DynamoDB

- [ ] テーブル作成（`EmergencyInfo`）
- [ ] テストデータ投入
- [ ] スキーマ設計の確定

#### Lambda - NotifyFamily

- [ ] S3イベントトリガー設定
- [ ] LINE Messaging API統合
- [ ] 署名付きURL生成との連携

#### Lambda - HandleLineWebhook

- [ ] LINE Webhook受信処理
- [ ] リッチメニューアクション処理
- [ ] Device Shadow更新ロジック

---

### 🔜 未着手項目

#### Raspberry Pi実装

- [ ] OS・Python環境構築
- [ ] AWS IoT SDK統合
- [ ] カメラモジュール接続
- [ ] 物理ボタンGPIO実装
- [ ] メインアプリケーション（main.py）開発
- [ ] Device Shadow同期処理
- [ ] 自動起動設定（systemd）

#### LINE Bot機能

- [ ] リッチメニュー画像作成
- [ ] リッチメニューJSON定義
- [ ] Messaging APIでのメニュー登録
- [ ] Webhook URL最終設定

#### Webダッシュボード

- [ ] 複数カメラ対応のグリッド表示
- [ ] JavaScript自動リフレッシュ機能（5秒間隔）
- [ ] 署名付きURL取得の統合

---

## 4. 主要機能の進捗

| 機能カテゴリ                  | 進捗率 | 状態        | 備考                           |
| ----------------------------- | ------ | ----------- | ------------------------------ |
| LINE Bot基盤                  | 80%    | ✅ ほぼ完了 | Group ID取得済み               |
| AWS IoT Core                  | 100%   | ✅ 完了     | 証明書・エンドポイント確定     |
| S3ストレージ（Images）        | 100%   | ✅ 完了     | 暗号化・ライフサイクル設定済み |
| S3ストレージ（Dashboard）     | 90%    | ✅ ほぼ完了 | CloudFront統合済み             |
| CloudFront CDN                | 90%    | ✅ ほぼ完了 | 署名付きURL対応済み            |
| Lambda（署名付きURL生成）     | 100%   | ✅ 完了     | 本番運用可能                   |
| Lambda（通知処理）            | 30%    | ⏳ 開発中   | LINE API統合待ち               |
| Lambda（コマンド処理）        | 20%    | ⏳ 設計中   | Webhook処理実装待ち            |
| DynamoDB                      | 0%     | 🔜 未着手   | スキーマ設計待ち               |
| Raspberry Piアプリ            | 0%     | 🔜 未着手   | ハードウェア準備待ち           |
| LINEリッチメニュー            | 0%     | 🔜 未着手   | デザイン作成待ち               |
| Webダッシュボード（フロント） | 60%    | ⏳ 開発中   | HTML実装済み、JS機能開発中     |

**総合進捗: 約 55%**

---

## 5. セキュリティ対応状況

### ✅ 実装済みセキュリティ対策

#### S3セキュリティ

- ✅ **プライベートバケット化**
  - パブリックアクセス完全ブロック
  - CloudFront OACのみアクセス許可
- ✅ **サーバーサイド暗号化（SSE-S3）**
  - AES-256暗号化で保存時のデータ保護
- ✅ **バージョニング有効化**
  - 誤削除・改ざんからの復旧可能
- ✅ **署名付きURL配信**
  - CloudFront経由で時間制限付きアクセス
  - 有効期限: 1時間

#### IoT Core セキュリティ

- ✅ **証明書ベース認証**
  - X.509証明書による相互TLS認証
  - Private Keyの厳格管理
- ✅ **最小権限ポリシー**
  - 必要な操作のみ許可（Connect, Publish, Subscribe）

#### Lambda セキュリティ

- ✅ **環境変数の暗号化**
  - AWS Secrets Manager連携（準備中）
- ✅ **IAMロール最小権限**
  - 各Lambda関数に必要最小限の権限のみ付与

---

### ⚠️ セキュリティ課題と対応予定

#### 🟡 中優先度

1. **CORS設定の厳格化**
   - **現状:** `allowed_origins = ["*"]`（全ドメイン許可）
   - **リスク:** クロスサイトスクリプティングのリスク
   - **対応予定:** 特定ドメインのみ許可に変更

2. **アクセスログの有効化**
   - **現状:** CloudFront/S3のアクセスログ無効
   - **リスク:** セキュリティインシデント調査が困難
   - **対応予定:** ログバケット作成とログ記録開始

3. **CloudFront WAF統合**
   - **現状:** WAF未導入
   - **リスク:** DDoS攻撃やボット攻撃に脆弱
   - **対応予定:** AWS WAF設定（レート制限、Geo制限）

#### 🟢 低優先度

1. **タグ管理の統一**
   - 一部リソースでタグが不統一
   - コスト管理の精度向上のため対応予定

2. **バリデーション強化**
   - Terraform preconditionの追加
   - デプロイ前チェックの強化

---

## 6. 今後の実装予定

### フェーズ1: コアシステム完成（2週間）

#### Week 1

- [ ] DynamoDBテーブル作成とデータ投入
- [ ] Lambda NotifyFamily実装
  - S3イベントトリガー設定
  - LINE Messaging API統合
  - 署名付きURL生成との連携
- [ ] Lambda HandleLineWebhook実装
  - Webhook受信処理
  - LINE署名検証
  - Device Shadow更新ロジック

#### Week 2

- [ ] Raspberry Pi環境構築
  - OS・Python環境セットアップ
  - AWS IoT SDK統合
  - カメラモジュール接続
- [ ] メインアプリケーション開発（main.py）
  - 物理ボタン監視
  - Device Shadow同期
  - 撮影・アップロードループ
- [ ] 単体テスト実施

---

### フェーズ2: UI/UX完成（1週間）

#### Week 3

- [ ] LINEリッチメニュー実装
  - メニュー画像作成
  - JSON定義作成
  - Messaging APIでメニュー登録
- [ ] Webダッシュボード完成
  - JavaScript自動リフレッシュ機能
  - 複数カメラグリッド表示
  - レスポンシブデザイン対応

---

### フェーズ3: テストと最適化（1週間）

#### Week 4

- [ ] 結合テスト
  - エンドツーエンド動作確認
  - 緊急モード発動テスト
  - 通知の嵐テスト
  - リッチメニュー操作テスト
- [ ] セキュリティ対策完了
  - CORS設定厳格化
  - アクセスログ有効化
  - WAF設定
- [ ] 運用設定
  - Raspberry Pi自動起動設定
  - ログローテーション設定
  - 監視・アラート設定

---

### フェーズ4: 本番稼働（継続）

- [ ] 本番環境デプロイ
- [ ] 運用マニュアル作成
- [ ] 家族向け操作マニュアル作成
- [ ] 定期メンテナンス計画策定

---

## 7. 既知の問題と課題

### 🔴 高優先度

1. **HTMLファイルの未実装**
   - **状態:** ✅ 解決済み
   - **内容:** index.html/error.htmlを実装済み

2. **DynamoDBテーブル未作成**
   - **状態:** ⏳ 対応待ち
   - **影響:** 通報機能が使用不可
   - **予定:** フェーズ1 Week1で実装

3. **Raspberry Piアプリ未開発**
   - **状態:** ⏳ 対応待ち
   - **影響:** システムの中核機能が動作しない
   - **予定:** フェーズ1 Week2で実装

---

### 🟡 中優先度

1. **CORS設定が過度に緩い**
   - **状態:** ⏳ 対応予定
   - **リスク:** セキュリティリスク
   - **予定:** フェーズ3で対応

2. **アクセスログ未設定**
   - **状態:** ⏳ 対応予定
   - **影響:** セキュリティ監査が困難
   - **予定:** フェーズ3で対応

3. **キャッシュ戦略のトレードオフ**
   - **状態:** 検討中
   - **内容:** 5秒TTLでキャッシュ効果が限定的
   - **影響:** コスト最適化の余地あり
   - **対応案:** キャッシュバスティング導入を検討

---

### 🟢 低優先度

1. **タグ管理の不統一**
   - 一部リソースでタグが不足
   - コスト管理の精度向上のため対応予定

2. **エラーハンドリングの強化**
   - より詳細なエラーハンドリングを追加予定

3. **CloudFront圧縮設定**
   - 現在有効だが、画像(JPEG)には効果が限定的
   - HTML/CSS/JSには有効

---

## 8. コスト見積もり

### 月間想定コスト（1台運用時）

| サービス        | 項目                    | 想定量            | 単価               | 月額費用（USD） |
| --------------- | ----------------------- | ----------------- | ------------------ | --------------- |
| **S3**          | ストレージ（Images）    | 10GB              | $0.023/GB          | $0.23           |
| **S3**          | ストレージ（Dashboard） | 1GB               | $0.023/GB          | $0.02           |
| **S3**          | PUT/POST（画像）        | 518,400リクエスト | $0.005/1,000       | $2.59           |
| **S3**          | GET（画像）             | 100,000リクエスト | $0.0004/1,000      | $0.04           |
| **CloudFront**  | データ転送（画像）      | 50GB              | $0.114/GB          | $5.70           |
| **CloudFront**  | HTTPSリクエスト         | 100,000           | $0.012/10,000      | $1.20           |
| **Lambda**      | 実行回数（通知）        | 518,400回         | $0.20/100万        | $0.10           |
| **Lambda**      | 実行時間（通知）        | 25,920秒          | $0.0000166667/GB秒 | $0.43           |
| **Lambda**      | 実行回数（コマンド）    | 1,000回           | $0.20/100万        | $0.00           |
| **Lambda**      | 実行回数（署名URL）     | 10,000回          | $0.20/100万        | $0.00           |
| **DynamoDB**    | ストレージ              | 0.1GB             | $0.25/GB           | $0.03           |
| **DynamoDB**    | 読み取り                | 1,000             | $0.25/100万        | $0.00           |
| **IoT Core**    | メッセージング          | 520,000           | $1.00/100万        | $0.52           |
| **API Gateway** | HTTPリクエスト          | 11,000            | $1.00/100万        | $0.01           |

**合計: 約 $10.87/月（約1,500円/月）**

### コスト削減案

1. **CloudFront TTL最適化**
   - キャッシュバスティング導入で月額 $5〜7削減可能
2. **S3ライフサイクル最適化**
   - 保存期間を6時間に短縮で約30%削減可能

3. **Lambda実行時間最適化**
   - コード最適化で実行時間を50%削減可能

**最適化後の想定コスト: 約 $5〜7/月**

---

## 9. 関連ドキュメント

### 設計・仕様書

- [全体設計書](docs/Project/Design/Design.md)
- [要件定義・ロードマップ](docs/Project/Design/RDD.md)

### 問題管理

- [既知の問題一覧](docs/Project/Proplems/Issues.md)
- [TODOリスト](docs/Project/Proplems/TODO.md)

### セットアップガイド

- [Terraformセットアップ](docs/Setup/terraform-setup.md.md)
- [AWS CLIセットアップ](docs/Setup/aws-cli-setup.md)
- [秘匿ファイル管理](docs/Setup/secret_files.md)
- [セキュリティ実装ガイド](docs/Setup/security-implementation.md)

### モジュール別README

- [S3 Images Bucket](S3/Images/README.md)
- [S3 Dashboard Bucket](S3/Dashboard/README.md)
- [Lambda GenerateSignedURL](Lambda/GenerateSignedURL/README.md)
- [Lambda FetchGroupID](Lambda/FetchGroupID/README.md)
- [DynamoDB](Dynamodb/README.md)
- [IoT Core](IotCore/README.md)

---

## 10. 連絡先・サポート

### プロジェクトリポジトリ

- GitHub: `/Users/sksrdik/workspace/Project/Grandma_Alert`

### 技術スタック

- **Infrastructure:** AWS (IoT Core, S3, Lambda, DynamoDB, CloudFront, API Gateway)
- **IaC:** Terraform
- **Edge Device:** Raspberry Pi, Python 3.x
- **Notification:** LINE Messaging API
- **Frontend:** HTML, CSS, JavaScript (Vanilla)

---

## 📊 プロジェクトステータスサマリー

| 項目                   | 状態                  |
| ---------------------- | --------------------- |
| **プロジェクト進捗**   | 55%                   |
| **本番稼働予定**       | 4週間後               |
| **セキュリティ状態**   | 良好（一部改善予定）  |
| **コスト状況**         | 予算内（月額1,500円） |
| **技術リスク**         | 低〜中                |
| **次のマイルストーン** | DynamoDB + Lambda実装 |

---

**Document Version:** 1.0  
**Last Updated:** 2026年1月23日  
**Next Review:** 2026年2月1日
